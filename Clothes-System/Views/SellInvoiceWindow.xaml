<Window x:Class="Clothes_System.Views.SellInvoiceWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="فاتورة بيع"
        Width="800" Height="650"
        WindowStartupLocation="CenterScreen"
        FlowDirection="RightToLeft"
        Background="#F0F4F8"
        FontSize="18">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ERROR MESSAGE -->
        <TextBlock Grid.Row="0" Text="{Binding ErrorMessage}" 
                   Foreground="Red" FontWeight="Bold" 
                   Margin="0,0,0,10" 
                   TextWrapping="Wrap"
                   FontSize="20"/>

        <!-- ITEM ENTRY -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,12" HorizontalAlignment="Center">

            <StackPanel>
                <Label Content="اختر النموذج" Foreground="Gray" FontSize="18"/>
                <ComboBox Width="160"
                          Height="36"
                          FontSize="18"
                          ItemsSource="{Binding Models}"
                          DisplayMemberPath="Name"
                          SelectedItem="{Binding SelectedModel}"/>
            </StackPanel>

            <StackPanel Margin="10,0,0,0">
                <Label Content="الكمية" Foreground="Gray" FontSize="18"/>
                <TextBox Width="80" Height="36" FontSize="18"
                         Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <StackPanel Margin="10,0,0,0">
                <Label Content="سعر الوحدة" Foreground="Gray" FontSize="18"/>
                <TextBox Width="100" Height="36" FontSize="18"
                         Text="{Binding UnitPrice, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <Button Width="140" Height="38" Margin="15,20,0,0"
                    Background="#007ACC" Foreground="White" FontWeight="Bold"
                    FontSize="18"
                    Content="إضافة عنصر"
                    Command="{Binding AddItemCommand}"/>
        </StackPanel>

        <!-- ITEMS GRID -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding InvoiceItems}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  Margin="0,0,0,12"
                  AlternatingRowBackground="#E6F0FA"
                  RowBackground="White"
                  FontSize="18"
                  HorizontalAlignment="Stretch">
            <DataGrid.Columns>
                <DataGridTextColumn Header="النموذج" Binding="{Binding ModelName}" Width="*" />
                <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity}" Width="80" />
                <DataGridTextColumn Header="سعر الوحدة" Binding="{Binding UnitPrice, StringFormat='{}{0:C}'}" Width="100"/>
                <DataGridTextColumn Header="الإجمالي" Binding="{Binding Total, StringFormat='{}{0:C}'}" Width="100"/>
                <DataGridTemplateColumn Width="60">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="❌" 
                                    Command="{Binding DataContext.RemoveItemCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    Background="Transparent" BorderThickness="0"
                                    FontSize="20"
                                    ToolTip="Remove item"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- TOTALS SECTION -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,15">

            <StackPanel>
                <TextBlock Text="الإجمالي:" FontWeight="Bold" Margin="0,0,10,5" FontSize="20"/>
                <TextBlock Text="{Binding TotalAmount, StringFormat='{}{0:C}'}" FontSize="20" FontWeight="Bold" Foreground="Green"/>
            </StackPanel>

            <StackPanel Margin="20,0,0,0">
                <TextBlock Text="المبلغ المدفوع:" FontWeight="Bold" Margin="0,0,10,5" FontSize="20"/>
                <TextBlock Text="{Binding PaymentAmount, StringFormat='{}{0:C}'}" FontSize="20" FontWeight="Bold" Foreground="Blue"/>
            </StackPanel>

            <StackPanel Margin="20,0,0,0">
                <TextBlock Text="المتبقي:" FontWeight="Bold" Margin="0,0,10,5" FontSize="20"/>
                <TextBlock Text="{Binding RemainingAmount, StringFormat='{}{0:C}'}"
                           FontSize="20"
                           FontWeight="Bold"
                           Name="RemainingAmountText" VerticalAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="Green"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RemainingAmount}" Value="0">
                                    <Setter Property="Foreground" Value="Green"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding RemainingAmount}">
                                    <Setter Property="Foreground" Value="Red"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StackPanel>

        </StackPanel>

        <!-- PAYMENT SECTION & BUTTONS -->
        <Grid Grid.Row="4">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- PAYMENT SECTION -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">

                <StackPanel>
                    <Label Content="طريقة الدفع" Foreground="Gray" FontSize="18"/>
                    <ComboBox Width="160"
                              Height="36"
                              FontSize="18"
                              ItemsSource="{Binding PaymentTypes}"
                              SelectedItem="{Binding SelectedPaymentMethod, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Margin="15,0,0,0">
                    <Label Content="المبلغ المدفوع" Foreground="Gray" FontSize="18"/>
                    <TextBox Width="140" Height="36" FontSize="18"
                             Text="{Binding PaymentAmount, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Enter payment amount (0 for credit)"/>
                </StackPanel>

            </StackPanel>

            <!-- FOOTER BUTTONS -->
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom">

                <Button Width="110" Height="40" Margin="5,0,0,0"
                        Content="إلغاء"
                        Background="#DC3545"
                        Foreground="White"
                        FontSize="18"
                        FontWeight="Bold"
                        Click="Cancel_Click"/>

                <Button Width="110" Height="40" Margin="5,0,0,0"
                        Content="حفظ"
                        Background="#28A745"
                        Foreground="White"
                        FontSize="18"
                        FontWeight="Bold"
                        Command="{Binding SaveCommand}"/>

            </StackPanel>

        </Grid>
    </Grid>
</Window>
